@model List<HjuletRestaurang.Models.Dish>

@{
    ViewBag.Title = "Menu";
}

<div class="container">
    <div class="row">
        <div class="col-sm-4 col-sm-offset-4">
            <h2 class="text-center">Menu</h2>
        </div>
    </div>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>Dish name</th>
            <th>Price</th>
            <th>Add</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var dish in Model)
        {
            <tr>
                <td>@dish.Name</td>
                <td><span class="badge">@dish.Price</span></td>
                <td><input class="checkbox" type="checkbox" value=@dish.Id></td>
            </tr>
        }
        </tbody>
    </table>
    @Html.ActionLink(" ","orders", "home", null, new {@class="glyphicon glyphicon-shopping-cart btn btn-default", id="submit"})
   
</div>

@section scripts{
    <script src="~/signalr/js"></script>

    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var restaurant = $.connection.restaurantHub;
            $('#submit').click(function () {
                var checkedBoxesVal = "";
                var selectedBoxes = [];
                var checkboxes = $(".checkbox");
                for (var i = 0; i < checkboxes.length; i++) {
                    if (checkboxes[i].checked) {
                        selectedBoxes.push(checkboxes[i]);
                    }
                }

                for (var c = 0; c < selectedBoxes.length; c++) {
                    checkedBoxesVal = checkedBoxesVal.concat(checkboxes[c].value);
                    if (c < selectedBoxes.length - 1) {
                        checkedBoxesVal = checkedBoxesVal.concat(",");
                    }
                }

                restaurant.server.sendOrder(checkedBoxesVal);
            });
            $.connection.hub.start().done(function () {
                console.log("Done!");
            });
        });

        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}