@model List<HjuletRestaurang.Models.Dish>

@{
    ViewBag.Title = "Home Page";
}

@foreach (var dish in Model)
{
    <input class="checkbox" type="checkbox" value=@dish.Id />
    <p>@dish.Name</p>
    <p>@dish.Price</p>
}
@*<input id ="checkbox" type="checkbox" value=@Guid.NewGuid()/>*@
<button id="submit" class="btn btn-default">Beställ</button>

<div class="container">
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion"></ul>
</div>

@section scripts{
    <script src="~/signalr/js"></script>

    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var restaurantHub = $.connection.restaurantHub;
            // Create a function that the hub can call back to display messages.
            restaurantHub.client.send = function (name, message) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>' + htmlEncode(name)
                    + '</strong>: ' + htmlEncode(message) + '</li>');
            };
            // Get the user name and store it to prepend to messages.
            $('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub.
                    restaurantHub.server.send($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }


        $(function () {
            // Reference the auto-generated proxy for the hub.
            var restaurant = $.connection.restaurantHub;
            $('#submit').click(function () {
                var checkedBoxesVal = "";
                var selectedBoxes = [];
                var checkboxes = $(".checkbox");
                for (var i = 0; i < checkboxes.length; i++) {
                    if (checkboxes[i].checked) {
                        selectedBoxes.push(checkboxes[i]);
                    }
                }

                for (var c = 0; c < selectedBoxes.length; c++) {
                    checkedBoxesVal = checkedBoxesVal.concat(checkboxes[c].value);
                    if (c < selectedBoxes.length - 1) {
                        checkedBoxesVal = checkedBoxesVal.concat(",");
                    }
                }

                restaurant.server.sendOrder(checkedBoxesVal);
            });
            $.connection.hub.start().done(function () {
                console.log("Done!");
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>

}
